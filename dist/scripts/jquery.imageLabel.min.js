"use strict";function imageLabel(e){function i(){function e(){var e=$(".imageLabel-imgdrop"),i=[];e.each(function(e,a){var n=$(a).width()*$(a).height();i.push(n)}),e.each(function(e,a){var n=$(a),t=n.width()*n.height(),l=0;$.each(i,function(e,i){t<=i&&l++}),n.css({"z-index":l})})}function i(){var e=$(".imageLabel-img"),i=$(".imageLabel-jisuan"),a=e[0].naturalWidth,n=e[0].naturalHeight,t=e.parents(".imageLabel-img-body").width(),l=e.parents(".imageLabel-img-body").height();a/n>t/l?i.css({width:"100%",height:n/a*t}):i.css({height:"100%",width:a/n*l})}var t,s,d,o,c,g,m,r=$(".imageLabel-content"),b=!1,p=!1,v=!1,y=$(".imageLabel-drap-menu");$(".imageLabel-content")[0].oncontextmenu=function(){return!1},y[0].oncontextmenu=function(){return!1},$("body").click(function(e){y.hide()}),$.each(n.data,function(e,i){s=$('<div class="imageLabel-imgdrop imageLabel-drop-has"><span class="imageLabel-imgdrop-font">'+i.name+'</span><div class="imageLable-i-s"></div></div>');for(var a=0;a<8;a++)s.find(".imageLable-i-s").append('<i class="imageLable-i">');if(n.shade)for(var t=0;t<4;t++)s.append('<em class="imageLable-em">');var l=i;s.css({left:100*(l.ex-l.x>0?l.x:l.ex)+"%",top:100*(l.ey-l.y>0?l.y:l.ey)+"%",width:100*Math.abs(l.ex-l.x)+"%",height:100*Math.abs(l.ey-l.y)+"%"}).attr("data-json",JSON.stringify(i)),r.append(s)}),e(),$(".imageLabel-content").mousedown(function(e){if(o=e.button,2!=e.button){if(y.hide(),b=!0,r=$(this),t={x:r.offset().left,y:r.offset().top,cx:e.clientX,cy:e.clientY,w:r.width(),h:r.height()},d={x:(t.cx-t.x)/t.w,y:(t.cy-t.y)/t.h,ex:0,ey:0},$(e.target).hasClass("imageLabel-imgdrop"))p=!0,s=$(e.target),c=JSON.parse(s.attr("data-json")),d=$.extend({},c),n.startArea();else if($(e.target).hasClass("imageLable-i"))v=!0,g=$(e.target),s=$(e.target).parents(".imageLabel-imgdrop"),c=JSON.parse(s.attr("data-json")),d=$.extend({},c);else{m=(new Date).getTime(),p=!1,s=$('<div class="imageLabel-imgdrop"><span class="imageLabel-imgdrop-font"></span><div class="imageLable-i-s"></div></div>');for(var i=0;i<8;i++)s.find(".imageLable-i-s").append('<i class="imageLable-i">');if(n.shade)for(var a=0;a<4;a++)s.append('<em class="imageLable-em">');s.addClass("imageLabel-drop-edit").appendTo(r),s.siblings().removeClass("imageLabel-drop-edit")}s.addClass("imageLabel-drop-now"),n.only&&$(this).find(".imageLabel-imgdrop").hide()}else $(e.target).hasClass("imageLabel-imgdrop")&&(s=$(e.target),setTimeout(function(){y.css({left:e.clientX,top:e.clientY}).show()},0))}),$(".imageLabel-img-boxs").mousemove(function(e){if(b){if(p)d.x=c.x+(e.clientX-t.cx)/t.w,d.ex=c.ex+(e.clientX-t.cx)/t.w,d.y=c.y+(e.clientY-t.cy)/t.h,d.ey=c.ey+(e.clientY-t.cy)/t.h;else if(v){var i=g.index();0==i&&(d.x=c.x+(e.clientX-t.cx)/t.w,d.y=c.y+(e.clientY-t.cy)/t.h),1==i&&(d.ex=c.ex+(e.clientX-t.cx)/t.w,d.y=c.y+(e.clientY-t.cy)/t.h),2==i&&(d.ex=c.ex+(e.clientX-t.cx)/t.w,d.ey=c.ey+(e.clientY-t.cy)/t.h),3==i&&(d.x=c.x+(e.clientX-t.cx)/t.w,d.ey=c.ey+(e.clientY-t.cy)/t.h),4==i&&(d.y=c.y+(e.clientY-t.cy)/t.h),5==i&&(d.ex=c.ex+(e.clientX-t.cx)/t.w),6==i&&(d.ey=c.ey+(e.clientY-t.cy)/t.h),7==i&&(d.x=c.x+(e.clientX-t.cx)/t.w)}else d.ex=(e.clientX-t.x)/t.w,d.ey=(e.clientY-t.y)/t.h;d.y<0&&(d.y=0),d.x<0&&(d.x=0),d.ey<0&&(d.ey=0),d.ex<0&&(d.ex=0),d.ey>1&&(d.ey=1),d.ex>1&&(d.ex=1),d.y>1&&(d.y=1),d.x>1&&(d.x=1),s.css({left:100*(d.ex-d.x>0?d.x:d.ex)+"%",top:100*(d.ey-d.y>0?d.y:d.ey)+"%",width:100*Math.abs(d.ex-d.x)+"%",height:100*Math.abs(d.ey-d.y)+"%"}).addClass("imageLabel-drop-move")}}).mouseup(function(i){if(b){var a={};d.x<d.ex?(a.x=d.x,a.ex=d.ex):(a.x=d.ex,a.ex=d.x),d.y<d.ey?(a.y=d.y,a.ey=d.ey):(a.y=d.ey,a.ey=d.y),s.attr("data-json",JSON.stringify($.extend(d,a))),Math.abs(i.clientX-t.cx)>10&&Math.abs(i.clientY-t.cy)>10&&!p&&!v?(n.editPop&&$(".imageLabel-input").addClass("imageLabel-active").find("input").focus().val(""),n.edit(s)):p||v||s.remove(),b=!1,p=!1,v=!1,e(),s.removeClass("imageLabel-drop-now imageLabel-drop-move")}n.only&&$(this).find(".imageLabel-imgdrop").show()});var x=$(".imageLabel-input"),f=x.find("input");x.find(".imageLabel-input-close").click(function(){x.removeClass("imageLabel-active")}),x.find(".imageLabel-input-ok").click(function(){s.find("span").html(f.val()),x.removeClass("imageLabel-active")}),$(".imageLabel-delete").click(function(){s.remove(),y.hide()}),$(".imageLabel-edit").click(function(){n.edit(s),s.addClass("imageLabel-drop-edit").siblings().removeClass("imageLabel-drop-edit"),n.editPop&&x.addClass("imageLabel-active").find("input").focus().val(s.find("span").html()),y.hide()}),f.keydown(function(e){13==e.keyCode&&x.find(".imageLabel-input-ok").click()}),$(window).keydown(function(e){27==e.keyCode&&x.hasClass("imageLabel-active")&&x.removeClass("imageLabel-active")}),i(),$(window).resize(i),$(".imageLabel-closes").click(function(){n.close(a.getData())&&l.removeClass("imageLabel-box-active")}).next().click(function(){n.confirm(a.getData())&&l.removeClass("imageLabel-box-active")})}if(!e.img)return alert("请填写图片地址"),!1;var a={getData:function(){var e=[];return $(".imageLabel-imgdrop").each(function(){e.push(JSON.parse($(this).attr("data-json")))}),e},clearArea:function(){$(".imageLabel-imgdrop").remove()},close:function(){$(".imageLabel-closes").click()}},n={only:!1,shade:!0,editPop:!0,close:function(){return!0},edit:function(){},confirm:function(){return!0},startArea:function(){},clickArea:function(){},data:[]};n=$.extend(n,e),$("imageLable-box").remove();var t='<div class="imageLabel-box">\n    <div class="imageLabel">\n        <div class="imageLabel-img-boxs">\n            <span class="imageLabel-img-body">\n                <div class="imageLabel-loading-body">\n                    <div class="imageLabel-loading"></div>\n                </div>\n                <div class="imageLabel-jisuan" style="position: relative;overflow:hidden;">\n                    <img src="'+e.img+'" alt="" style=\'position: absolute;with:100%;height:100%;\' class="imageLabel-img">\n                    <div class="imageLabel-content">\n\n                    </div>\n                </div>\n            </span>\n            <ul class="imageLabel-drap-menu">\n                <div style=\'overflow: hidden;\'>\n                    <div style="cursor: pointer;" class="imageLabel-delete btns">删除</div>\n                    <div style="cursor: pointer;" class="imageLabel-edit btns">编辑</div>\n                </div>\n                \x3c!--\n\n                <li style=\'padding:10px;\'>\n                    <i></i>红色\n                </li>\n                <li style=\'padding:10px;\'>\n                    <i></i>红色\n                </li>\n                --\x3e\n            </ul>\n        </div>\n        <div class="imageLabel-buttons">\n            <div class="imageLabel-btn imageLabel-closes">关闭</div>\n            <div class="imageLabel-btn">确定</div>\n        </div>\n        <div class="imageLabel-input" style=\'background-color:rgba(255,255,255,0.3);\'>\n            <div class="imageLabel-input-box" style=\'width:250px;\'>\n                <div style=\'background-color: #333;\'>\n                    <div style=\'color:#fff;overflow:hidden;line-height: 40px;\'>\n                        <span style=\'float: left;margin-left:20px;\'>编辑内容</span>\n                        <span class="imageLabel-input-close" style=\'float:right;margin-right:20px;cursor: pointer;\'>X</span>\n                    </div>\n                </div>\n\n                <div style=\'background: #fff;padding:20px;\'>\n                    <input type="text" value=\'\' max=\'10\' style=\'width:100%;padding:5px;\'>\n                    <div style=\'margin-top:20px;overflow:hidden;\'>\n                        <div class="imageLabel-input-close imageLabel-btn" style=\'float: left;width:90px;background-color: #959595;\'>取消</div>\n                        <div class="imageLabel-input-ok imageLabel-btn" style=\'float: right;width:90px;\'>确定</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>',l=$(t);return l.find(".imageLabel-img").one("load",function(){$(this).addClass("imageLabel-img-active"),$(".imageLabel-loading-body").hide(),i()}),l.appendTo("body"),setTimeout(function(){l.addClass("imageLabel-box-active")},0),a}